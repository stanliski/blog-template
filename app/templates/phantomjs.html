<!DOCTYPE html><html><head><title>PhantomJS-快速入门教程</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-3" class="wmd-preview-section preview-content"></div><div id="wmd-preview-section-321" class="wmd-preview-section preview-content">

<h1 id="phantomjs-快速入门教程">PhantomJS-快速入门教程</h1>

<p> <br>
<strong>PhantomJS</strong> 是一款PhantomJS 是一个基于 WebKit 的服务器端 JavaScript API。它全面支持web而不需浏览器支持，其快速，原生支持各种Web标准： DOM 处理, CSS 选择器, JSON, Canvas, 和 SVG。 PhantomJS 可以用于 <code>页面自动化</code> ， <code>网络监测</code> ， <code>网页截屏</code> ，以及 <code>无界面测试</code> 等。</p></div><div id="wmd-preview-section-326" class="wmd-preview-section preview-content">

<h2 id="安装">安装</h2>

<p>安装包下载地址： <a href="http://phantomjs.org/download.html" target="_blank">http://phantomjs.org/download.html</a> ，包括 Windows ，Mac OS，Linux版本，自行选择对应 版本下载解压即可（ 为方便使用，可自已为phantomjs设置环境变量 ），其中带有一个example文件夹，里面有很多已经写好的代码供使用。本文假设phantomjs已经安装好并已设置了环境变量。</p></div><div id="wmd-preview-section-460" class="wmd-preview-section preview-content">

<h2 id="使用">使用</h2></div><div id="wmd-preview-section-766" class="wmd-preview-section preview-content">

<h3 id="hello-world">Hello world</h3>

<p>新建一个包含下面两行脚本的文本文件：</p>

</div><div id="wmd-preview-section-823" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs autoit"><span class="hljs-comment line-number">1.</span>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'Hello, world!'</span>)<span class="hljs-comment">;</span><br><span class="hljs-comment line-number">2.</span>phantom.<span class="hljs-keyword">exit</span>()<span class="hljs-comment">;</span><br></code></pre>

<p>将文件另存为 hello.js ,然后执行它：</p>

</div><div id="wmd-preview-section-905" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs css"><span class="hljs-comment line-number">1.</span><span class="hljs-tag">phantomjs</span> <span class="hljs-tag">hello</span><span class="hljs-class">.js</span><br></code></pre>

<p>输出结果为：</p>

</div><div id="wmd-preview-section-956" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs erlang-repl"><span class="hljs-comment line-number">1.</span><span class="hljs-variable">Hello</span>, <span class="hljs-function_or_atom">world</span><span class="hljs-exclamation_mark">!</span><br></code></pre>

<p>第一行将会在终端打印出字符串，第二行 phantom.exit 将退出运行。  <br>
在该脚本中调用 phantom.exit 是非常重要的，否则 PhantomJS 将根本不会停止。</p></div><div id="wmd-preview-section-987" class="wmd-preview-section preview-content">

<h3 id="脚本参数">脚本参数</h3>

<p>Phantomjs如何传递参数呢？如下所示 ：</p>

</div><div id="wmd-preview-section-1219" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-javascript hljs"><span class="hljs-comment line-number">1.</span>phantomjs examples/<span class="hljs-built_in">arguments</span>.js foo bar baz<br></code></pre>

<p>其中的foo, bar, baz就是要传递的参数，如何获取呢：</p>

</div><div id="wmd-preview-section-1280" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs perl"><span class="hljs-comment line-number">1.</span>var <span class="hljs-keyword">system</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">'system'</span>);<br><span class="hljs-comment line-number">2.</span><span class="hljs-keyword">if</span> (<span class="hljs-keyword">system</span>.args.<span class="hljs-keyword">length</span> === <span class="hljs-number">1</span>) {<br><span class="hljs-comment line-number">3.</span>    console.<span class="hljs-keyword">log</span>(<span class="hljs-string">'Try to pass some args when invoking this script!'</span>);<br><span class="hljs-comment line-number">4.</span>} <span class="hljs-keyword">else</span> {<br><span class="hljs-comment line-number">5.</span>    <span class="hljs-keyword">system</span>.args.forEach(function (arg, i) {<br><span class="hljs-comment line-number">6.</span>            console.<span class="hljs-keyword">log</span>(i + <span class="hljs-string">': '</span> + arg);<br><span class="hljs-comment line-number">7.</span>    });<br><span class="hljs-comment line-number">8.</span>}<br><span class="hljs-comment line-number">9.</span>phantom.<span class="hljs-keyword">exit</span>();<br></code></pre>

<p>它将输出 ：</p>

</div><div id="wmd-preview-section-1333" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs http"><span class="hljs-comment line-number">1.</span><span class="hljs-attribute">0</span>: <span class="hljs-string">foo</span><br><span class="hljs-comment line-number">2.</span><span class="hljs-attribute">1</span>: <span class="hljs-string">bar</span><br><span class="hljs-comment line-number">3.</span><span class="hljs-attribute">2</span>: <span class="hljs-string">baz</span><br></code></pre>

</div><div id="wmd-preview-section-1489" class="wmd-preview-section preview-content">

<h3 id="页面截图">页面截图</h3>

<p>通过创建一个网页对象，一个网页可以被加载，分析和渲染。 <br>
下面的脚本将示例页面对象最简单的用法，它加载 example.com 并且将它保存为一张图片， example.png 。</p></div><div id="wmd-preview-section-1580" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs php"><span class="hljs-comment line-number">1.</span><span class="hljs-keyword">var</span> page = <span class="hljs-keyword">require</span>(<span class="hljs-string">'webpage'</span>).create();<br><span class="hljs-comment line-number">2.</span>page.open(<span class="hljs-string">'http://example.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{<br><span class="hljs-comment line-number">3.</span>    page.render(<span class="hljs-string">'example.png'</span>);<br><span class="hljs-comment line-number">4.</span>    phantom.<span class="hljs-keyword">exit</span>();<br><span class="hljs-comment line-number">5.</span>});<br></code></pre>

<p>由于它的这个特性，PhantomJS 可以用来 网页截屏 ，截取一些内容的快照，比如将网页、SVG存成图片，PDF等，这个功能很牛X。 <br>
接下来的 loadspeed.js 脚本加载一个特殊的URL (不要忘了http协议) 并且计量加载该页面的时间。</p>

</div><div id="wmd-preview-section-1677" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs perl"><span class="hljs-comment line-number">1.</span>var page = <span class="hljs-keyword">require</span>(<span class="hljs-string">'webpage'</span>).create(),<br><span class="hljs-comment line-number">2.</span>    <span class="hljs-keyword">system</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">'system'</span>),<br><span class="hljs-comment line-number">3.</span>    t, address;<br><span class="hljs-comment line-number">4.</span><br><span class="hljs-comment line-number">5.</span><span class="hljs-keyword">if</span> (<span class="hljs-keyword">system</span>.args.<span class="hljs-keyword">length</span> === <span class="hljs-number">1</span>) {<br><span class="hljs-comment line-number">6.</span>    console.<span class="hljs-keyword">log</span>(<span class="hljs-string">'Usage: loadspeed.js &lt;some URL&gt;'</span>);<br><span class="hljs-comment line-number">7.</span>    phantom.<span class="hljs-keyword">exit</span>();<br><span class="hljs-comment line-number">8.</span>}<br><span class="hljs-comment line-number">9.</span><br><span class="hljs-comment line-number">10.</span>t = Date.now();<br><span class="hljs-comment line-number">11.</span>address = <span class="hljs-keyword">system</span>.args[<span class="hljs-number">1</span>];<br><span class="hljs-comment line-number">12.</span>page.<span class="hljs-keyword">open</span>(address, function (status) {<br><span class="hljs-comment line-number">13.</span>    <span class="hljs-keyword">if</span> (status !== <span class="hljs-string">'success'</span>) {<br><span class="hljs-comment line-number">14.</span>        console.<span class="hljs-keyword">log</span>(<span class="hljs-string">'FAIL to load the address'</span>);<br><span class="hljs-comment line-number">15.</span>    } <span class="hljs-keyword">else</span> {<br><span class="hljs-comment line-number">16.</span>        t = Date.now() - t;<br><span class="hljs-comment line-number">17.</span>        console.<span class="hljs-keyword">log</span>(<span class="hljs-string">'Loading time '</span> + t + <span class="hljs-string">' msec'</span>);<br><span class="hljs-comment line-number">18.</span>    }<br><span class="hljs-comment line-number">19.</span>    phantom.<span class="hljs-keyword">exit</span>();<br><span class="hljs-comment line-number">20.</span>});<br></code></pre>

<p>在命令行运行该脚本：</p>

</div><div id="wmd-preview-section-1729" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs stylus"><span class="hljs-comment line-number">1.</span>phantomjs loadspeed<span class="hljs-class">.js</span> http:<span class="hljs-comment">//www.google.com</span><br></code></pre>

<p>它输出像下面的东西：</p>

</div><div id="wmd-preview-section-1730" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs groovy"><span class="hljs-comment line-number">1.</span>Loading  <span class="hljs-string">http:</span><span class="hljs-comment">//www.google.com  Loading time 719 msec</span><br></code></pre></div><div id="wmd-preview-section-1821" class="wmd-preview-section preview-content">

<h3 id="dom">Dom</h3>

<p>由于脚本好像是一个Web浏览器上运行的一样，标准的DOM脚本和CSS选择器可以很好的工作。这使得PhantomJS适合支持各种 页面自动化任务 。 <br>
下面的  useragent.js  将读取 id  为myagent的元素的  textContent  属性：</p></div><div id="wmd-preview-section-2011" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs javascript"><span class="hljs-comment line-number">1.</span><span class="hljs-keyword">var</span> page = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpage'</span>).create();<br><span class="hljs-comment line-number">2.</span><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The default user agent is '</span> + page.settings.userAgent);<br><span class="hljs-comment line-number">3.</span>page.settings.userAgent = <span class="hljs-string">'SpecialAgent'</span>;<br><span class="hljs-comment line-number">4.</span>page.open(<span class="hljs-string">'http://www.httpuseragent.org'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">status</span>) </span>{<br><span class="hljs-comment line-number">5.</span>    <span class="hljs-keyword">if</span> (status !== <span class="hljs-string">'success'</span>) {<br><span class="hljs-comment line-number">6.</span>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Unable to access network'</span>);<br><span class="hljs-comment line-number">7.</span>    } <span class="hljs-keyword">else</span> {<br><span class="hljs-comment line-number">8.</span>        <span class="hljs-keyword">var</span> ua = page.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{<br><span class="hljs-comment line-number">9.</span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'myagent'</span>).textContent;<br><span class="hljs-comment line-number">10.</span>        });<br><span class="hljs-comment line-number">11.</span>        <span class="hljs-built_in">console</span>.log(ua);<br><span class="hljs-comment line-number">12.</span>    }<br><span class="hljs-comment line-number">13.</span>    phantom.exit();<br><span class="hljs-comment line-number">14.</span>});<br></code></pre>

<p>上面示例同样提供了一种自定义 user agent 的方法。 <br>
使用JQuery及其他类库：</p>

</div><div id="wmd-preview-section-2072" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs javascript"><span class="hljs-comment line-number">1.</span><span class="hljs-keyword">var</span> page = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpage'</span>).create();<br><span class="hljs-comment line-number">2.</span>page.open(<span class="hljs-string">'http://www.sample.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br><span class="hljs-comment line-number">3.</span>    page.includeJs(<span class="hljs-string">"http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br><span class="hljs-comment line-number">4.</span>        page.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br><span class="hljs-comment line-number">5.</span>            $(<span class="hljs-string">"button"</span>).click();<br><span class="hljs-comment line-number">6.</span>        });<br><span class="hljs-comment line-number">7.</span>        phantom.exit()<br><span class="hljs-comment line-number">8.</span>    });<br><span class="hljs-comment line-number">9.</span>});<br></code></pre></div><div id="wmd-preview-section-2262" class="wmd-preview-section preview-content">

<h4 id="网络请求及响应-network-requests-and-responses">网络请求及响应 – Network Requests and Responses</h4>

<p>将一个页面从一台远程服务器请求一个资源的时候，请求和响应均可以通过 onResourceRequested  和  onResourceReceived  回调方法追踪到。示例  netlog.js ：</p></div><div id="wmd-preview-section-2307" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs javascript"><span class="hljs-comment line-number">1.</span><span class="hljs-keyword">var</span> page = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpage'</span>).create();<br><span class="hljs-comment line-number">2.</span>page.onResourceRequested = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request</span>) </span>{<br><span class="hljs-comment line-number">3.</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Request '</span> + <span class="hljs-built_in">JSON</span>.stringify(request, <span class="hljs-literal">undefined</span>, <span class="hljs-number">4</span>));<br><span class="hljs-comment line-number">4.</span>};<br><span class="hljs-comment line-number">5.</span>page.onResourceReceived = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>{<br><span class="hljs-comment line-number">6.</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Receive '</span> + <span class="hljs-built_in">JSON</span>.stringify(response, <span class="hljs-literal">undefined</span>, <span class="hljs-number">4</span>));<br><span class="hljs-comment line-number">7.</span>};<br><span class="hljs-comment line-number">8.</span>page.open(url);<br></code></pre>

<p>PhantomJs官网： <a href="http://phantomjs.org/" target="_blank">http://phantomjs.org/</a></p>

<p>GitHub: <a href="https://github.com/ariya/phantomjs/wiki/Quick-Start" target="_blank">https://github.com/ariya/phantomjs/wiki/Quick-Start</a></p></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>